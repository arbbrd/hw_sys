# **sdb_12_7_arb**

## Задание_1

Опишите основные преимущества использования масштабирования методами:
- активный master-сервер и пассивный репликационный slave-сервер;
- master-сервер и несколько slave-серверов;

## Решение_1

1. Активный Master и пассивный Slave-сервер.

Основные преимущества:

- Повышение отказоустойчивости: если master выходит из строя, slave можно вручную или автоматически повысить до роли нового master, минимизируя время простоя (downtime). Это резервная копия данных в "горячем" режиме.

- ️Резервное копирование без нагрузки на master: можно выполнять тяжелые операции бэкапа (mysqldump, создание снепшота) на slave-сервере, не создавая нагрузки на master и не влияя на работу основного приложения.

- Аналитика без вмешательства в основную работу: на slave можно запускать тяжелые аналитические запросы и отчеты, которые выполняются долго и потребляют много ресурсов. Это не скажется на производительности основного master, обслуживающего критически важные транзакции.

- Простота архитектуры: легче настроить и администрировать по сравнению с кластером из множества серверов. Меньше точек отказа в сети репликации.

- Небольшое распределение нагрузки на чтение: технически, часть запросов на чтение можно перенаправить на slave.

2. Master-сервер и несколько Slave-серверов.

Основные преимущества:

- Мощное горизонтальное масштабирование чтения: позволяет распределять нагрузку только на чтение на множество серверов. Добавляя новые slave-серверы, вы линейно увеличиваете capacity для обработки SELECT-запросов. Идеально для read-heavy приложений (блоги, медиа, каталоги товаров).

- ️Географическое распределение: slave-серверы можно размещать в разных дата-центрах или регионах (например, в Европе, Азии, Америке). Это снижает задержку (latency) для пользователей в разных частях мира, повышает отказоустойчивость на уровне региона.

- Изоляция различных типов нагрузки: можно выделить специализированных slave-ов под разные задачи:
    - Slave для веб-приложения: Обслуживает быстрые запросы пользователей.
    - Slave для аналитики: Выполняет тяжелые отчеты.
    - Slave для бэкапа: Только для создания резервных копий.
    Проблема на одном slave (например, "убийственный" аналитический запрос) не затронет остальные.

- Повышенная отказоустойчивость на чтение: если один из slave-серверов падает, остальные продолжают обслуживать запросы на чтение. Приложение просто перенаправляет трафик на работающие ноды. Доступность данных для чтения близка к 100%.

- Гибкость при сбоях master: из нескольких slave можно выбрать наиболее актуального (с наименьшим отставанием репликации) для быстрого продвижения в новый master после аварии.


## Задание_2

Разработайте план для выполнения горизонтального и вертикального шаринга базы данных. База данных состоит из трёх таблиц:
- пользователи,
- книги,
- магазины (столбцы произвольно).

Опишите принципы построения системы и их разграничение или разбивку между базами данных.
Пришлите блоксхему, где и что будет располагаться. Опишите, в каких режимах будут работать сервера.

## Решение_2

План для выполнения горизонтального и вертикального шаринга базы данных.

1. Структура таблиц:

```
users  : user_id, name, email, phone, address, registration_date
books  : book_id, title, author, isbn, price, genre, publication_year
stores : store_id, name, address, phone, working_hours, manager_id
```

2. Принципы разбивки:

Вертикальный шаринг (разделение по столбцам):
- Разделяем таблицы по функциональным блокам данных.
- Каждая подсистема получает только необходимые ей поля.
- Уменьшает объём передаваемых данных, повышает безопасность.

Горизонтальный шаринг (разделение по строкам):
- Данные разбиваются по диапазонам ключей (например, user_id от 1–1000, 1001–2000 и т. д.).
- Позволяет масштабировать нагрузку по серверам.
- Обеспечивает равномерное распределение запросов.

3. Схема разбивки:

Вертикальное разделение:

- User Service DB
    - Таблица users_core: user_id, name, email
    - Таблица users_contact: user_id, phone, address

- Book Service DB
    - Таблица books_core: book_id, title, author, isbn
    - Таблица books_price: book_id, price
    - Таблица books_meta: book_id, genre, publication_year

- Store Service DB
    - Таблица stores_core: store_id, name, manager_id
    - Таблица stores_location: store_id, address
    - Таблица stores_contact: store_id, phone, working_hours

Горизонтальное разделение (шардинг по ID):

- Каждый сервис БД разбивается на 3 шарда по диапазону ID:
    - Шард 1: ID 1–3333
    - Шард 2: ID 3334–6666
    - Шард 3: ID 6667–10000


4. Блок-схема:

```
+---------------------------------------------------------------+
|                     КЛИЕНТСКИЕ ПРИЛОЖЕНИЯ                     |
|  (Web, Mobile, API) → Запросы через API Gateway               |
+---------------------------------------------------------------+
                                ↓
+---------------------------------------------------------------+
|                       API GATEWAY                             |
|  - Маршрутизация запросов                                     |
|  - Балансировка нагрузки                                      |
|  - Аутентификация                                             |
+---------------------------------------------------------------+
                                ↓
+--------------------+     +--------------------+    +--------------------+
|   USER SERVICE     |     |   BOOK SERVICE     |    |   STORE SERVICE    |
|   (Микросервис)    |     |   (Микросервис)    |    |   (Микросервис)    |
+--------------------+     +--------------------+    +--------------------+
          ↓                       ↓                       ↓
+--------------------+     +--------------------+    +--------------------+
| USER DB CLUSTER    |     | BOOK DB CLUSTER    |    | STORE DB CLUSTER   |
| (3 шарда + реплики)|     | (3 шарда + реплики)|    | (3 шарда + реплики)|
+--------------------+     +--------------------+    +--------------------+
  Шард 1  Шард 2  Шард 3    Шард 1  Шард 2  Шард 3    Шард 1  Шард 2  Шард 3
  (Master+Slave)             (Master+Slave)            (Master+Slave)

```

5. Режимы работы серверов.

Шарды (Master):

- Приём операций записи (INSERT, UPDATE, DELETE).
- Синхронная репликация на реплики.
- Обработка части SELECT-запросов.

Реплики (Slave):

- Только чтение (SELECT).
- Асинхронная репликация от Master.
- Горизонтальное масштабирование для чтения.
- Отказоустойчивость (при падении Master реплики могут стать Master).

API Gateway:

- Активный-активный режим (несколько инстансов).
- Автоматическое обнаружение сервисов.
- Кэширование часто запрашиваемых данных.

Микросервисы (User/Book/Store Service):

- Без состояния (stateless).
- Горизонтальное масштабирование (добавление инстансов при нагрузке).
- Health checks и автоматическое восстановление.


Преимущества схемы:

- Масштабируемость: добавление шардов и реплик при росте нагрузки.
- Отказоустойчивость: реплики обеспечивают работу при падении Master.
- Безопасность: вертикальный шаринг ограничивает доступ к чувствительным данным.
- Производительность: распределение запросов по шардам и репликам.
- Гибкость: независимые микросервисы позволяют обновлять компоненты отдельно.